Enum "action_type" {
  "CREATE"
  "UPDATE"
  "DELETE"
}

Enum "actor_type" {
  "USER"
  "SYSTEM"
}

Enum "chat_sender" {
  "USER"
  "BOT"
}

Enum "document_status" {
  "ACTIVE"
  "INACTIVE"
}

Enum "project_status" {
  "ACTIVE"
  "INACTIVE"
}

Enum "user_role" {
  "ADMIN"
  "USER"
}

Enum "user_status" {
  "ACTIVE"
  "INACTIVE"
  "PENDING_REGISTRATION"
}

Table "kysely_migration" {
  "name" varchar(255) [pk, not null]
  "timestamp" varchar(255) [not null]
}

Table "kysely_migration_lock" {
  "id" varchar(255) [pk, not null]
  "is_locked" int4 [not null, default: 0]
}

Table "line_accounts" {
  "id" text [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "active_line_session_id" uuid
}

Table "users" {
  "id" uuid [pk, not null]
  "email" text [not null]
  "password" text
  "last_signed_in_at" timestamptz
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "role" user_role [not null]
  "user_status" user_status [not null]
  "line_account_id" text [unique]
}

Table "user_otps" {
  "id" text [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "user_id" uuid [not null]
  "expire_at" timestamptz [not null]
}

Table "user_groups" {
  "id" uuid [pk, not null]
  "group_name" text [not null]
  "description" text [not null, default: '']
}

Table "user_group_users" {
  "id" uuid [pk, not null]
  "user_id" uuid [not null]
  "user_group_id" uuid [not null]
}

Table "projects" {
  "id" uuid [pk, not null]
  "project_name" text [not null]
  "project_description" text [not null, default: '']
  "project_guideline_md" text [not null, default: '']
  "project_status" project_status [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "ai_summary_md" text [not null, default: '']
}

Table "project_chats" {
  "id" uuid [pk, not null]
  "chat_sender" chat_sender [not null]
  "message" text [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "parent_id" uuid
  "user_id" uuid [not null]
  "project_id" uuid [not null]
}

Table "user_group_projects" {
  "id" uuid [pk, not null]
  "project_id" uuid [not null]
  "user_group_id" uuid [not null]
}

Table "user_manage_projects" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "project_id" uuid [not null]
  "user_id" uuid [not null]
}

Table "project_documents" {
  "id" uuid [pk, not null]
  "project_id" uuid [not null]
  "document_status" document_status [not null]
  "ai_summary_md" text [not null, default: '']
}

Table "stored_files" {
  "id" uuid [pk, not null]
  "ref_name" text [not null]
  "key_path" text [not null]
  "owner_table" text [not null]
  "owner_id" uuid [not null]
  "filename" text [not null]
  "filesize_byte" int8 [not null]
  "storage_name" text [not null, default: 's3']
  "presign_url" text [not null]
  "is_public" bool [not null, default: false]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "mime_type" text [not null]
  "extension" text [not null]
  "checksum" text
  "expire_at" timestamptz

  Indexes {
    (owner_table, owner_id) [type: btree, name: "stored_files_ref_owner_idx"]
  }
}

Table "line_sessions" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "line_account_id" text [not null]
  "project_id" uuid [not null]
  "latest_chat_log_id" uuid
}

Table "line_chat_logs" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "line_session_id" uuid [not null]
  "chat_sender" chat_sender [not null]
  "parent_id" uuid
  "message" text [not null]

  Indexes {
    line_session_id [type: btree, name: "line_chat_logs_line_session_id_idx"]
  }
}

Table "audit_logs" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "actor_type" actor_type [not null, default: 'SYSTEM']
  "action_type" action_type [not null, default: 'CREATE']
  "action_detail" text [not null, default: '']
  "created_by_id" uuid
  "owner_table" text [not null]
  "owner_id" uuid [not null]
  "raw_data" jsonb [not null]
}

Ref "audit_logs_created_by_id_fkey":"users"."id" < "audit_logs"."created_by_id"

Ref "line_accounts_active_line_session_id_fkey":"line_sessions"."id" < "line_accounts"."active_line_session_id" [delete: set null]

Ref "line_chat_logs_line_session_id_fkey":"line_sessions"."id" < "line_chat_logs"."line_session_id" [delete: cascade]

Ref "line_chat_logs_parent_id_fkey":"line_chat_logs"."id" < "line_chat_logs"."parent_id" [delete: set null]

Ref "line_sessions_latest_chat_log_id_fkey":"line_chat_logs"."id" < "line_sessions"."latest_chat_log_id" [delete: set null]

Ref "line_sessions_line_account_id_fkey":"line_accounts"."id" < "line_sessions"."line_account_id" [delete: cascade]

Ref "line_sessions_project_id_fkey":"projects"."id" < "line_sessions"."project_id" [delete: cascade]

Ref "project_chats_parent_id_fkey":"project_chats"."id" < "project_chats"."parent_id" [delete: set null]

Ref "project_chats_project_id_fkey":"projects"."id" < "project_chats"."project_id" [delete: cascade]

Ref "project_chats_user_id_fkey":"users"."id" < "project_chats"."user_id" [delete: cascade]

Ref "project_documents_project_id_fkey":"projects"."id" < "project_documents"."project_id" [delete: cascade]

Ref "user_group_projects_project_id_fkey":"projects"."id" < "user_group_projects"."project_id" [delete: cascade]

Ref "user_group_projects_user_group_id_fkey":"user_groups"."id" < "user_group_projects"."user_group_id" [delete: cascade]

Ref "user_group_users_user_group_id_fkey":"user_groups"."id" < "user_group_users"."user_group_id" [delete: cascade]

Ref "user_group_users_user_id_fkey":"users"."id" < "user_group_users"."user_id" [delete: cascade]

Ref "user_manage_projects_project_id_fkey":"projects"."id" < "user_manage_projects"."project_id" [delete: cascade]

Ref "user_manage_projects_user_id_fkey":"users"."id" < "user_manage_projects"."user_id" [delete: cascade]

Ref "user_otps_user_id_fkey":"users"."id" < "user_otps"."user_id" [delete: cascade]

Ref "users_line_account_id_fkey":"line_accounts"."id" < "users"."line_account_id" [delete: set null]
