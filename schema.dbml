Enum "action_type" {
  "CREATE"
  "UPDATE"
  "DELETE"
}

Enum "actor_type" {
  "USER"
  "SYSTEM"
}

Enum "ai_usage_action" {
  "CHAT_LINE"
  "CHAT_PROJECT"
  "GENERATE_PROJECT_SUMMARY"
  "GENERATE_PROJECT_DOCUMENT_SUMMARY"
}

Enum "chat_sender" {
  "USER"
  "BOT"
}

Enum "document_status" {
  "ACTIVE"
  "INACTIVE"
  "PROCESSING"
}

Enum "line_session_status" {
  "ACTIVE"
  "INACTIVE"
}

Enum "message_status" {
  "INVALID_PAYLOAD"
  "FAIL"
  "SUCCESS"
  "DEAD"
}

Enum "project_status" {
  "ACTIVE"
  "INACTIVE"
  "PROCESSING"
}

Enum "user_role" {
  "ADMIN"
  "MANAGER"
  "USER"
}

Enum "user_status" {
  "ACTIVE"
  "INACTIVE"
  "PENDING_REGISTRATION"
}

Table "kysely_migration" {
  "name" varchar(255) [pk, not null]
  "timestamp" varchar(255) [not null]
}

Table "kysely_migration_lock" {
  "id" varchar(255) [pk, not null]
  "is_locked" int4 [not null, default: 0]
}

Table "line_accounts" {
  "id" text [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
}

Table "users" {
  "id" uuid [pk, not null]
  "email" text [unique, not null]
  "first_name" text [not null]
  "last_name" text [not null]
  "password" text
  "last_signed_in_at" timestamptz
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "created_by_id" uuid
  "updated_by_id" uuid
  "role" user_role [not null]
  "user_status" user_status [not null]
  "line_account_id" text [unique]
}

Table "user_verifications" {
  "id" uuid [pk, not null]
  "code" text [unique, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "user_id" uuid [not null]
  "revoke_at" timestamptz
  "expire_at" timestamptz [not null]
}

Table "user_groups" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "created_by_id" uuid
  "updated_by_id" uuid
  "group_name" text [not null]
  "description" text [not null, default: '']
}

Table "user_group_users" {
  "user_id" uuid [not null]
  "user_group_id" uuid [not null]

  Indexes {
    (user_id, user_group_id) [type: btree, name: "pk_user_group_users"]
  }
}

Table "user_group_managers" {
  "user_id" uuid [not null]
  "user_group_id" uuid [not null]

  Indexes {
    (user_id, user_group_id) [type: btree, name: "pk_user_group_managers"]
  }
}

Table "projects" {
  "id" uuid [pk, not null]
  "project_name" text [not null]
  "project_description" text [not null, default: '']
  "project_guideline_md" text [not null, default: '']
  "is_require_regenerate" bool [not null, default: false]
  "project_status" project_status [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "created_by_id" uuid
  "updated_by_id" uuid
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "ai_summary_md" text [not null, default: '']
}

Table "user_group_projects" {
  "project_id" uuid [not null]
  "user_group_id" uuid [not null]

  Indexes {
    (project_id, user_group_id) [type: btree, name: "pk_user_group_projects"]
  }
}

Table "user_manage_projects" {
  "project_id" uuid [not null]
  "user_id" uuid [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]

  Indexes {
    (project_id, user_id) [type: btree, name: "pk_user_manage_projects"]
  }
}

Table "project_documents" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "is_require_regenerate" bool [not null, default: false]
  "project_id" uuid [not null]
  "created_by_id" uuid
  "updated_by_id" uuid
  "document_details" text [not null, default: '']
  "document_status" document_status [not null]
  "ai_summary_md" text [not null, default: '']
}

Table "stored_files" {
  "id" uuid [pk, not null]
  "ref_name" text [not null]
  "key_path" text [not null]
  "owner_table" text [not null]
  "owner_id" uuid [not null]
  "filename" text [not null]
  "filesize_byte" int8 [not null]
  "storage_name" text [not null, default: 's3']
  "presign_url" text [not null]
  "is_public" bool [not null, default: false]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "mime_type" text [not null]
  "extension" text [not null]
  "checksum" text
  "expire_at" timestamptz

  Indexes {
    (owner_id, ref_name) [type: btree, name: "stored_files_owner_id_ref_name_idx"]
  }
}

Table "line_bots" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "channel_access_token" text [not null]
  "channel_secret" text [not null]
}

Table "line_sessions" {
  "id" uuid [pk, not null]
  "line_session_status" line_session_status [not null, default: 'ACTIVE']
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "updated_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "line_account_id" text [not null]
  "project_id" uuid [not null]
  "line_bot_id" uuid [not null]
  "latest_chat_log_id" uuid
}

Table "line_chat_logs" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "line_account_id" text [not null]
  "line_session_id" uuid
  "chat_sender" chat_sender [not null]
  "parent_id" uuid
  "message" text [not null]

  Indexes {
    line_session_id [type: btree, name: "line_chat_logs_line_session_id_idx"]
  }
}

Table "project_chat_sessions" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "user_id" uuid [not null]
  "project_id" uuid [not null]
  "latest_chat_log_id" uuid
}

Table "project_chat_logs" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "project_chat_session_id" uuid [not null]
  "chat_sender" chat_sender [not null]
  "message" text [not null]
  "parent_id" uuid
}

Table "audit_logs" {
  "id" uuid [pk, not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "actor_type" actor_type [not null, default: 'SYSTEM']
  "action_type" action_type [not null, default: 'CREATE']
  "action_detail" text [not null, default: '']
  "created_by_id" uuid
  "owner_table" text [not null]
  "owner_id" uuid [not null]
  "raw_data" jsonb [not null]

  Indexes {
    owner_id [type: btree, name: "audit_logs_owner_id_idx"]
  }
}

Table "ai_usages" {
  "id" uuid [pk, not null]
  "user_id" uuid
  "ai_usage_action" ai_usage_action [not null]
  "project_id" uuid [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "ai_request_at" timestamptz [not null]
  "ai_reply_at" timestamptz
  "reply_time_ms" int4
  "token_used" int4 [not null]
  "confidence" int2 [not null]
  "ref_table" text [not null]
  "ref_id" uuid [not null]
}

Table "sessions" {
  "id" uuid [pk, not null]
  "user_id" uuid [not null]
  "token_hash" text [not null]
  "device_uid" text [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "expire_at" timestamptz [not null]
  "revoke_at" timestamptz
  "info" jsonb [not null]

  Indexes {
    token_hash [type: btree, name: "sessions_token_hash"]
  }
}

Table "password_reset_tokens" {
  "id" uuid [pk, not null]
  "user_id" uuid [not null]
  "token_hash" text [not null]
  "created_at" timestamptz [not null, default: `CURRENT_TIMESTAMP`]
  "expire_at" timestamptz [not null]
  "revoke_at" timestamptz

  Indexes {
    token_hash [type: btree, name: "password_reset_tokens_token_hash"]
  }
}

Table "message_tasks" {
  "id" uuid [pk, not null]
  "queue_name" varchar [not null]
  "exchange_name" varchar [not null]
  "payload" jsonb [not null]
  "message_status" message_status [not null]
  "attempts" int4 [not null, default: 0]
  "max_attempts" int4 [not null, default: 5]
  "last_error" text
  "created_at" timestamptz [not null, default: `now()`]
  "updated_at" timestamptz [not null, default: `now()`]
  "expire_at" timestamptz [not null]
}

Ref "audit_logs_created_by_id_fkey":"users"."id" < "audit_logs"."created_by_id"

Ref "line_sessions_latest_chat_log_id_fkey":"line_chat_logs"."id" < "line_sessions"."latest_chat_log_id" [delete: set null]

Ref "line_sessions_line_account_id_fkey":"line_accounts"."id" < "line_sessions"."line_account_id" [delete: cascade]

Ref "line_sessions_line_bot_id_fkey":"line_bots"."id" < "line_sessions"."line_bot_id" [delete: cascade]

Ref "line_sessions_project_id_fkey":"projects"."id" < "line_sessions"."project_id" [delete: cascade]

Ref "password_reset_tokens_user_id_fkey":"users"."id" < "password_reset_tokens"."user_id" [delete: cascade]

Ref "project_chat_logs_project_chat_session_id_fkey":"project_chat_sessions"."id" < "project_chat_logs"."project_chat_session_id" [delete: cascade]

Ref "project_chat_sessions_project_id_fkey":"projects"."id" < "project_chat_sessions"."project_id" [delete: cascade]

Ref "project_chat_sessions_user_id_fkey":"users"."id" < "project_chat_sessions"."user_id" [delete: cascade]

Ref "project_documents_created_by_id_fkey":"users"."id" < "project_documents"."created_by_id" [delete: set null]

Ref "project_documents_project_id_fkey":"projects"."id" < "project_documents"."project_id" [delete: cascade]

Ref "project_documents_updated_by_id_fkey":"users"."id" < "project_documents"."updated_by_id" [delete: set null]

Ref "projects_created_by_id_fkey":"users"."id" < "projects"."created_by_id" [delete: set null]

Ref "projects_updated_by_id_fkey":"users"."id" < "projects"."updated_by_id" [delete: set null]

Ref "sessions_user_id_fkey":"users"."id" < "sessions"."user_id" [delete: cascade]

Ref "user_group_managers_user_group_id_fkey":"user_groups"."id" < "user_group_managers"."user_group_id" [delete: cascade]

Ref "user_group_managers_user_id_fkey":"users"."id" < "user_group_managers"."user_id" [delete: cascade]

Ref "user_group_projects_project_id_fkey":"projects"."id" < "user_group_projects"."project_id" [delete: cascade]

Ref "user_group_projects_user_group_id_fkey":"user_groups"."id" < "user_group_projects"."user_group_id" [delete: cascade]

Ref "user_group_users_user_group_id_fkey":"user_groups"."id" < "user_group_users"."user_group_id" [delete: cascade]

Ref "user_group_users_user_id_fkey":"users"."id" < "user_group_users"."user_id" [delete: cascade]

Ref "user_groups_created_by_id_fkey":"users"."id" < "user_groups"."created_by_id" [delete: set null]

Ref "user_groups_updated_by_id_fkey":"users"."id" < "user_groups"."updated_by_id" [delete: set null]

Ref "user_manage_projects_project_id_fkey":"projects"."id" < "user_manage_projects"."project_id" [delete: cascade]

Ref "user_manage_projects_user_id_fkey":"users"."id" < "user_manage_projects"."user_id" [delete: cascade]

Ref "user_verifications_user_id_fkey":"users"."id" < "user_verifications"."user_id" [delete: cascade]

Ref "users_created_by_id_fkey":"users"."id" < "users"."created_by_id" [delete: set null]

Ref "users_line_account_id_fkey":"line_accounts"."id" < "users"."line_account_id" [delete: set null]

Ref "users_updated_by_id_fkey":"users"."id" < "users"."updated_by_id" [delete: set null]
